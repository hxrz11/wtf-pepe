# Poker Vision Tool

Инструмент для создания шаблонов (template matching) для распознавания элементов интерфейса онлайн-покера.

## Описание

Poker Vision Tool помогает подготовить набор шаблонов для последующего использования в покерном боте/ассистенте. Программа позволяет:

1. **Собирать скриншоты** игрового окна с заданным интервалом
2. **Нарезать регионы** из скриншотов по заданным координатам
3. **Размечать элементы** (карты, цифры, текст, маркеры) для создания шаблонов

## Требования

- Python 3.10+
- Windows 10/11 (для захвата окон)
- Разрешение окна игры: настраивается в config.json

## Установка

1. Установите Python 3.10 или выше

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Убедитесь, что файлы `config.json` и `regions.json` существуют в корневой папке

## Запуск

```bash
python main.py
```

## Структура проекта

```
poker_vision/
├── main.py                 # Точка входа
├── config.json             # Настройки программы
├── regions.json            # Координаты всех регионов
├── requirements.txt        # Зависимости Python
├── README.md              # Документация
├── screenshots/            # Собранные скриншоты
├── regions_cut/            # Нарезанные регионы
├── templates/              # Размеченные шаблоны
│   ├── cards/              # 52 карты
│   ├── digits/             # 0-9, точка
│   ├── combos/             # Комбинации
│   ├── letters_lat/        # Латинские буквы
│   ├── letters_cyr/        # Кириллические буквы
│   ├── special/            # Спецсимволы
│   └── markers/            # Маркеры (дилер, таймер, место)
└── src/
    ├── core/               # Основная логика
    │   ├── window_manager.py
    │   ├── screenshot.py
    │   ├── region_cutter.py
    │   ├── symbol_splitter.py
    │   └── template_manager.py
    ├── ui/                 # Интерфейс
    │   ├── main_window.py
    │   ├── screenshot_mode.py
    │   ├── cutting_mode.py
    │   ├── labeling_mode.py
    │   └── settings_dialog.py
    └── utils/              # Утилиты
        ├── config.py
        └── image_utils.py
```

## Режимы работы

### 1. Режим сбора скриншотов (Screenshot Mode)

Захват скриншотов игрового окна:

1. Нажмите "Find Window" для поиска окна игры
2. Нажмите "Set Window Size" для установки нужного размера окна
3. Настройте интервал захвата (по умолчанию 2000 мс)
4. Нажмите "Start Capture" для начала сбора
5. Скриншоты сохраняются в `screenshots/` с именами `scrn_HHMMSS_mmm.png`

**Особенности:**
- Окно программы автоматически "прилипает" к правому краю игрового окна
- Захватывается только клиентская область окна (без рамок ОС)
- Счётчик показывает количество собранных скриншотов

### 2. Режим нарезки (Cutting Mode)

Нарезка регионов из скриншотов:

1. Нажмите "Load Screenshots" для загрузки скриншотов
2. Выберите скриншот из списка
3. Отметьте регионы для нарезки (чекбоксы)
4. Регионы визуализируются на скриншоте цветными рамками
5. Используйте зум для точной проверки координат
6. Нажмите "Cut Selected Regions" для нарезки по всем скриншотам

**Типы регионов (цвета рамок):**
- Зелёный: Карты (card)
- Красный: Числа (text_digits)
- Жёлтый: Смешанный текст (text_mixed)
- Пурпурный: Маркеры (marker)
- Оранжевый: Комбинации (combo)

**Навигация:**
- Кнопки "◄ Prev" / "Next ►" для перемещения между скриншотами
- Зум: 100%, 150%, 200%, 300%

### 3. Режим разметки (Labeling Mode)

Создание шаблонов из нарезанных регионов:

#### Карты (Cards)
1. Выберите категорию "Cards"
2. Выберите регион (my_card_1, my_card_2, board_1-5)
3. Нажмите "Load Region Files"
4. Введите значение карты: ранг + масть (например: `2c`, `Ah`, `Ks`)
   - Ранг: 2-9, T, J, Q, K, A
   - Масть: c (clubs), d (diamonds), h (hearts), s (spades)
5. Нажмите "Save" или Enter

**Прогресс:** Показывается количество размеченных карт из 52

#### Комбинации (Combos)
1. Выберите категорию "Combos"
2. Выберите регион "my_combo"
3. Загрузите файлы
4. Выберите тип комбинации из списка
5. Нажмите "Save Combo Template"

**Типы комбинаций:**
- High Card
- Pair
- Two Pair
- Three of a Kind
- Straight
- Flush
- Full House
- Four of a Kind
- Straight Flush
- Royal Flush

#### Маркеры (Markers)
1. Выберите категорию "Markers"
2. Выберите регион (dealer_pos_*, timer_pos_*, seat_*)
3. Загрузите файлы
4. Ответьте "Yes - Save as Template" если маркер присутствует, или "No - Skip"

**Типы маркеров:**
- dealer_button - кнопка дилера (D)
- timer - таймер хода
- seat_occupied - индикатор занятого места

#### Текст - Цифры (Text - Digits)
1. Выберите категорию "Text - Digits"
2. Выберите регион (stack_*, bet_*, pot)
3. Загрузите файлы
4. Программа автоматически разделит изображение на символы
5. Введите текст целиком (например: `12.59`)
6. Количество символов должно совпадать с обнаруженными
7. Нажмите "Save"

**Символы сохраняются в `templates/digits/`**

#### Текст - Смешанный (Text - Mixed)
1. Выберите категорию "Text - Mixed"
2. Выберите регион (name_*, match_id)
3. Загрузите файлы
4. Введите текст (буквы, цифры, спецсимволы)
5. Нажмите "Save"

**Символы сохраняются в:**
- `templates/digits/` - цифры
- `templates/letters_lat/` - латинские буквы
- `templates/letters_cyr/` - кириллические буквы
- `templates/special/` - спецсимволы

### Статистика шаблонов

Внизу режима Labeling отображается статистика созданных шаблонов:
- Cards: X/52
- Digits: количество
- Combos: X/10
- Markers: X/3
- Letters (Latin): количество
- Letters (Cyrillic): количество
- Special: количество

## Настройки (Settings)

Доступны через кнопку "Settings":

- **Game Window Title** - заголовок окна игры для поиска
- **Window Width/Height** - размер окна игры
- **Screenshot Interval** - интервал захвата скриншотов (мс)

Настройки сохраняются в `config.json`.

## Координаты регионов

Файл `regions.json` содержит координаты всех 46 регионов:

```json
{
  "region_id": {
    "x": 0,      // X координата
    "y": 0,      // Y координата
    "w": 0,      // Ширина
    "h": 0,      // Высота
    "type": ""   // Тип региона
  }
}
```

**Типы регионов:**
- `card` - карты (my_card_*, board_*)
- `text_digits` - числовой текст (stack_*, bet_*, pot)
- `text_mixed` - смешанный текст (name_*, match_id)
- `marker` - маркеры (dealer_pos_*, timer_pos_*, seat_*)
- `combo` - комбинации (my_combo)

**Важно:** Координаты задаются относительно клиентской области окна игры!

## Список регионов (46 шт)

### Карты (7):
- `my_card_1`, `my_card_2` - мои карты
- `board_1`, `board_2`, `board_3`, `board_4`, `board_5` - борд

### Стеки (6):
- `stack_0`, `stack_1`, `stack_2`, `stack_3`, `stack_4`, `stack_5`

### Ставки (6):
- `bet_0`, `bet_1`, `bet_2`, `bet_3`, `bet_4`, `bet_5`

### Банк (1):
- `pot`

### Позиция дилера (6):
- `dealer_pos_0`, `dealer_pos_1`, ..., `dealer_pos_5`

### Таймер (6):
- `timer_pos_0`, `timer_pos_1`, ..., `timer_pos_5`

### Места (6):
- `seat_0`, `seat_1`, ..., `seat_5`

### Имена (6):
- `name_0`, `name_1`, ..., `name_5`

### Другое (2):
- `my_combo` - моя комбинация
- `match_id` - ID матча

**Примечание:** Позиция 0 - всегда я (внизу стола)

## Рабочий процесс

Рекомендуемый порядок работы:

1. **Настройка координат**
   - Откройте игру
   - Сделайте несколько тестовых скриншотов
   - В режиме Cutting проверьте и скорректируйте координаты регионов в `regions.json`
   - Можно использовать зум для точности

2. **Сбор данных**
   - Режим Screenshot: соберите 50-100 скриншотов с разными ситуациями
   - Старайтесь захватить разные карты, стеки, комбинации

3. **Нарезка**
   - Режим Cutting: нарежьте все нужные регионы
   - Начните с карт и комбинаций (проще всего)

4. **Разметка**
   - Режим Labeling: создайте шаблоны
   - Порядок: карты → маркеры → комбинации → текст
   - Для карт достаточно 1-2 примера каждой
   - Для цифр нужно разметить несколько вариантов (шрифт может различаться)

5. **Проверка**
   - Убедитесь, что все 52 карты размечены
   - Проверьте наличие всех цифр 0-9 и точки
   - Проверьте маркеры и комбинации

## Советы по использованию

### Скриншоты
- Установите интервал 2-3 секунды для сбора разнообразных ситуаций
- Играйте в игру, пока идёт сбор - это даст больше вариаций
- Сохраните скриншоты с разными комбинациями, позициями дилера, таймерами

### Нарезка
- Используйте зум для точной проверки координат
- Если регион выходит за границы - скорректируйте в `regions.json`
- Нарезайте сначала одну категорию регионов, проверьте результат

### Разметка
- Начните с простых категорий (карты, маркеры)
- При разметке текста внимательно проверяйте количество обнаруженных символов
- Если символы склеиваются или разделяются неправильно - это нормально, программа использует простую эвристику

### Качество шаблонов
- Для карт достаточно 1 хорошего шаблона каждой карты
- Для цифр лучше иметь несколько вариантов из-за сглаживания/рендеринга
- Маркеры нужны в одном экземпляре

## Ограничения

- **Только Windows** - захват окон работает только на Windows через win32api
- **Фиксированное разрешение** - координаты привязаны к размеру окна
- **Простая сегментация** - разделение текста на символы использует базовый алгоритм
- **Template matching** - инструмент создаёт шаблоны для классического template matching, не ML

## Возможные проблемы

### Окно игры не найдено
- Проверьте, что игра запущена
- Убедитесь, что заголовок окна соответствует настройке в config.json
- Попробуйте изменить заголовок в Settings

### Регионы нарезаются неправильно
- Проверьте размер окна игры (должен совпадать с config.json)
- Используйте зум для точной проверки координат
- Скорректируйте координаты в regions.json

### Символы распознаются неправильно
- Это ожидаемо - используется простая сегментация по контурам
- Попробуйте разметить несколько примеров каждого символа
- В будущем можно улучшить алгоритм сегментации

### Программа не запускается
- Убедитесь, что установлены все зависимости: `pip install -r requirements.txt`
- Проверьте наличие config.json и regions.json
- Проверьте версию Python (нужна 3.10+)

## Лицензия

Этот инструмент создан для образовательных целей.

## Разработка

Структура кода:
- `src/core/` - основная логика (не зависит от GUI)
- `src/ui/` - интерфейс PyQt5
- `src/utils/` - вспомогательные функции

Для расширения функциональности:
- Добавление новых типов регионов: редактируйте regions.json и template_manager.py
- Улучшение сегментации: модифицируйте symbol_splitter.py
- Новые режимы работы: создайте новый виджет в src/ui/

## Контакты

Для вопросов и предложений создавайте issue в репозитории проекта.
